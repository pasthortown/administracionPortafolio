<div class="row p-2">
  <div class="col-12 mb-3">
    <div class="btn-toolbar" role="toolbar">
      <div class="btn-group mr-2" role="group">
        <button type="button" class="btn btn-primary" (click)="refresh()">
          <i class="fas fa-sync"></i>
        </button>
      </div>
      &nbsp;
      <div class="btn-group mr-2" role="group">
        <button type="button" class="btn btn-success" (click)="add_new_porfolio_item()">
          <i class="fas fa-add"></i>
        </button>
      </div>
      &nbsp;
      <div class="input-group mr-2">
        <span class="input-group-text">
          <i class="fas fa-search"></i>
        </span>
        <input type="text" [(ngModel)]="filter" class="form-control" placeholder="Buscar..." (input)="filter_table()">
        <button type="button" class="btn btn-info" (click)="toExcel()">
          <i class="fas fa-download"></i>
        </button>
      </div>
    </div>
  </div>
  <div class="col-12" style="overflow-x: auto;">
    <table class="table table-hover" style="min-width: 800px;">
      <thead>
        <tr>
          <th>Seleccionado</th>
          <th>Opciones</th>
          <th><small><strong>No.</strong></small></th>
          <th><small><strong>Año</strong></small></th>
          <th><small><strong>Mesa</strong></small></th>
          <th><small><strong>Título</strong></small></th>
          <th><small><strong>Descripción</strong></small></th>
          <th><small><strong>Prioridad</strong></small></th>
          <th><small><strong>Proyecto SAP</strong></small></th>
          <th><small><strong>Frente</strong></small></th>
          <th><small><strong>País</strong></small></th>
          <th><small><strong>Contacto Requirente</strong></small></th>
          <th><small><strong>Área</strong></small></th>
          <th><small><strong>Estado de Aprobación</strong></small></th>
          <th><small><strong>Progreso</strong></small></th>
          <th><small><strong>Prioridad Negocio</strong></small></th>
          <th><small><strong>Prioridad PO</strong></small></th>
          <th><small><strong>Dependencia</strong></small></th>
          <th><small><strong>Complejidad</strong></small></th>
          <th><small><strong>Factor País</strong></small></th>
          <th><small><strong>Semanas</strong></small></th>
          <th><small><strong>Personas</strong></small></th>
          <th><small><strong>Costo Operativo Semanal</strong></small></th>
          <th><small><strong>Otros Costos</strong></small></th>
          <th><small><strong>Costo Total</strong></small></th>
          <th><small><strong>Costos Recurrentes</strong></small></th>
          <th><small><strong>ROI</strong></small></th>
          <th><small><strong>Inicio Desarrollo</strong></small></th>
          <th><small><strong>Fin Desarrollo</strong></small></th>
          <th><small><strong>Inicio Piloto</strong></small></th>
          <th><small><strong>Fin Piloto</strong></small></th>
          <th><small><strong>Inicio Producción</strong></small></th>
          <th><small><strong>Fin Producción</strong></small></th>
          <th><small><strong>Notas</strong></small></th>
          <th><small><strong>ROI 2</strong></small></th>
          <th><small><strong>ROI 3</strong></small></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="newPorfolioItem">
          <td></td>
          <th>
            <div class="btn-group mr-2" role="group">
              <button type="button" class="btn btn-secondary" (click)="save_porfolio_item()">
                <i class="fas fa-save"></i>
              </button>
            </div>
          </th>
          <td><input type="number" disabled [(ngModel)]="new_porfolio_item.Id"/></td>
          <td><input type="number" [(ngModel)]="new_porfolio_item.Year"/></td>
          <td>
            <select [(ngModel)]="new_porfolio_item.AgileGroup">
              <option value="">Seleccione...</option>
              <option value="MAXPOINT LEGACY">MAXPOINT LEGACY</option>
              <option value="MAXPOINT NUEVO">MAXPOINT NUEVO</option>
              <option value="SIR">SIR</option>
              <option value="CANALES DIGITALES">CANALES DIGITALES</option>
              <option value="SISTEMAS INTERNOS">SISTEMAS INTERNOS</option>
              <option value="ERP">ERP</option>
              <option value="SAP">SAP</option>
              <option value="BI">BI</option>
              <option value="Devsecops">Devsecops</option>
            </select>
          </td>
          <td><input [(ngModel)]="new_porfolio_item.Title"/></td>
          <td><input [(ngModel)]="new_porfolio_item.Description"/></td>
          <td>
            <select [(ngModel)]="new_porfolio_item.Priority">
              <option value="">Seleccione...</option>
              <option value="BAJA">BAJA</option>
              <option value="MADIA">MADIA</option>
              <option value="ALTA">ALTA</option>
            </select>
          </td>
          <td><input [(ngModel)]="new_porfolio_item.SapProject"/></td>
          <td>
            <select [(ngModel)]="new_porfolio_item.Front">
              <option value="">Seleccione...</option>
              <option value="CAR">CAR</option>
              <option value="DSI">DSI</option>
              <option value="OPERACIONES">OPERACIONES</option>
              <option value="PLANTA">PLANTA</option>
              <option value="REGIONAL">REGIONAL</option>
            </select>
          </td>
          <td>
            <select [(ngModel)]="new_porfolio_item.Country">
              <option value="">Seleccione...</option>
              <option value="Argentina">Argentina</option>
              <option value="Chile">Chile</option>
              <option value="Colombia">Colombia</option>
              <option value="Ecuador">Ecuador</option>
              <option value="España">España</option>
              <option value="Venezuela">Venezuela</option>
            </select>
          </td>
          <td><input [(ngModel)]="new_porfolio_item.Contact"/></td>
          <td>
            <select [(ngModel)]="new_porfolio_item.Area">
              <option value="">Seleccione...</option>
              <option value="AEROPUERTO GYE">AEROPUERTO GYE</option>
              <option value="AEROPUERTO UIO">AEROPUERTO UIO</option>
              <option value="AR">AR</option>
              <option value="AUDITORIA">AUDITORIA</option>
              <option value="BI">BI</option>
              <option value="BODEGA">BODEGA</option>
              <option value="CALIDAD">CALIDAD</option>
              <option value="CAPACITACIÓN INTERNA">CAPACITACIÓN INTERNA</option>
              <option value="CL">CL</option>
              <option value="CO">CO</option>
              <option value="COMPRAS">COMPRAS</option>
              <option value="CONTABILIDAD">CONTABILIDAD</option>
              <option value="CONTABILIDAD Y SAP">CONTABILIDAD Y SAP</option>
              <option value="DSI">DSI</option>
              <option value="ES">ES</option>
              <option value="GESTIÓN">GESTIÓN</option>
              <option value="IT">IT</option>
              <option value="LOGÍSTICA">LOGÍSTICA</option>
              <option value="MANTENIMIENTO">MANTENIMIENTO</option>
              <option value="MERCADEO KFC">MERCADEO KFC</option>
              <option value="MERCADEO OTRAS MARCAS">MERCADEO OTRAS MARCAS</option>
              <option value="NÓMINA">NÓMINA</option>
              <option value="OPERACIONES">OPERACIONES</option>
              <option value="OPERACIONES KFC">OPERACIONES KFC</option>
              <option value="OTROS NEGOCIOS">OTROS NEGOCIOS</option>
              <option value="PLANTAS">PLANTAS</option>
              <option value="PRODUCCIÓN">PRODUCCIÓN</option>
              <option value="PROYECTOS DE CONSTRUCCIÓN">PROYECTOS DE CONSTRUCCIÓN</option>
              <option value="TRANSFORMACIÓN DIGITAL">TRANSFORMACIÓN DIGITAL</option>
              <option value="TESORERÍA">TESORERÍA</option>
              <option value="VE">VE</option>
            </select>
          </td>
          <td>
            <select [(ngModel)]="new_porfolio_item.Approval">
              <option value="">Seleccione...</option>
              <option value="APROBADO">APROBADO</option>
              <option value="IDENTIFICADO">IDENTIFICADO</option>
              <option value="SUSPENDIDO">SUSPENDIDO</option>
            </select>
          </td>
          <td>
            <select [(ngModel)]="new_porfolio_item.Progress">
              <option value="">Seleccione...</option>
              <option value="Cancelado">Cancelado</option>
              <option value="En curso">En curso</option>
              <option value="Finalizado">Finalizado</option>
              <option value="Identificado">Identificado</option>
              <option value="Iniciado">Iniciado</option>
              <option value="No iniciado">No iniciado</option>
              <option value="Por Levantar">Por Levantar</option>
              <option value="Pruebas">Pruebas</option>
            </select>
          </td>
          <td><input type="text" [(ngModel)]="new_porfolio_item.CustomerPriority"/></td>
          <td>
            <select [(ngModel)]="new_porfolio_item.PoPriority">
              <option value="">Seleccione...</option>
              <option value="Q1">Q1</option>
              <option value="Q2">Q2</option>
              <option value="Q3">Q3</option>
              <option value="Q4">Q4</option>
            </select>
          </td>
          <td><input [(ngModel)]="new_porfolio_item.Dependency"/></td>
          <td>
            <select [(ngModel)]="new_porfolio_item.Complexity">
              <option value="">Seleccione...</option>
              <option value="BAJA">BAJA</option>
              <option value="MADIA">MADIA</option>
              <option value="ALTA">ALTA</option>
            </select>
          </td>
          <td><input type="number" step="0.1" [(ngModel)]="new_porfolio_item.CountryFactor"/></td>
          <td><input type="number" [(ngModel)]="new_porfolio_item.Weeks"/></td>
          <td><input type="number" [(ngModel)]="new_porfolio_item.People"/></td>
          <td><input type="number" step="0.1" [(ngModel)]="new_porfolio_item.LaborCostPerWeek"/></td>
          <td><input type="number" step="0.1" [(ngModel)]="new_porfolio_item.OtherCosts"/></td>
          <td><input type="number" step="0.1" [(ngModel)]="new_porfolio_item.Total"/></td>
          <td><input type="number" step="0.1" [(ngModel)]="new_porfolio_item.RecurrentCosts"/></td>
          <td><input type="number" step="0.1" [(ngModel)]="new_porfolio_item.Roi"/></td>
          <td><input type="date" [ngModel]="new_porfolio_item.DevelopmentStart | date:'y-MM-dd'" (ngModelChange)="new_porfolio_item.DevelopmentStart = $event"/></td>
          <td><input type="date" [ngModel]="new_porfolio_item.DevelopmentEnd | date:'y-MM-dd'" (ngModelChange)="new_porfolio_item.DevelopmentEnd = $event"/></td>
          <td><input type="date" [ngModel]="new_porfolio_item.PilotStart | date:'y-MM-dd'" (ngModelChange)="new_porfolio_item.PilotStart = $event"/></td>
          <td><input type="date" [ngModel]="new_porfolio_item.PilotEnd | date:'y-MM-dd'" (ngModelChange)="new_porfolio_item.PilotEnd = $event"/></td>
          <td><input type="date" [ngModel]="new_porfolio_item.DeploymentStart | date:'y-MM-dd'" (ngModelChange)="new_porfolio_item.DeploymentStart = $event"/></td>
          <td><input type="date" [ngModel]="new_porfolio_item.DeploymentEnd | date:'y-MM-dd'" (ngModelChange)="new_porfolio_item.DeploymentEnd = $event"/></td>
          <td><input [(ngModel)]="new_porfolio_item.Notes"/></td>
          <td><input type="number" step="0.1" [(ngModel)]="new_porfolio_item.Roi2"/></td>
          <td><input type="number" step="0.1" [(ngModel)]="new_porfolio_item.Roi3"/></td>
        </tr>
        <tr *ngFor="let row of rows" (click)="row_selected = row">
          <td><small><span *ngIf="row_selected == row" class="far fa-hand-point-right"></span></small></td>
          <th>
            <div class="btn-group mr-2" role="group">
              <button type="button" class="btn btn-success" (click)="open_modal(content_costs)">
                <i class="fas fa-dollar-sign"></i>
              </button>
              <button type="button" class="btn btn-warning" (click)="edit = true">
                <i class="fas fa-edit"></i>
              </button>
              <button type="button" class="btn btn-secondary" (click)="update_porfolio_item()">
                <i class="fas fa-save"></i>
              </button>
              &nbsp;
              <button type="button" class="btn btn-danger" (click)="delete_porfolio_item()">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </th>
          <td><input *ngIf="edit && row_selected == row" type="number" [(ngModel)]="row.Id"/> <small *ngIf="!edit && row_selected == row">{{row.Id}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="number" [(ngModel)]="row.Year"/> <small *ngIf="!edit && row_selected == row">{{row.Year}}</small></td>
          <td>
            <select *ngIf="edit && row_selected == row" [(ngModel)]="row.AgileGroup">
              <option value="">Seleccione...</option>
              <option value="MAXPOINT LEGACY">MAXPOINT LEGACY</option>
              <option value="MAXPOINT NUEVO">MAXPOINT NUEVO</option>
              <option value="SIR">SIR</option>
              <option value="CANALES DIGITALES">CANALES DIGITALES</option>
              <option value="SISTEMAS INTERNOS">SISTEMAS INTERNOS</option>
              <option value="ERP">ERP</option>
              <option value="SAP">SAP</option>
              <option value="BI">BI</option>
              <option value="Devsecops">Devsecops</option>
            </select> <small *ngIf="!edit && row_selected == row">{{row.AgileGroup}}</small></td>
          <td><input *ngIf="edit && row_selected == row" [(ngModel)]="row.Title"/> <small *ngIf="!edit && row_selected == row">{{row.Title}}</small></td>
          <td><input *ngIf="edit && row_selected == row" [(ngModel)]="row.Description"/> <small *ngIf="!edit && row_selected == row">{{row.Description}}</small></td>
          <td>
            <select *ngIf="edit && row_selected == row" [(ngModel)]="row.Priority">
              <option value="">Seleccione...</option>
              <option value="BAJA">BAJA</option>
              <option value="MADIA">MADIA</option>
              <option value="ALTA">ALTA</option>
            </select> <small *ngIf="!edit && row_selected == row">{{row.Priority}}</small></td>
          <td><input *ngIf="edit && row_selected == row" [(ngModel)]="row.SapProject"/> <small *ngIf="!edit && row_selected == row">{{row.SapProject}}</small></td>
          <td>
            <select *ngIf="edit && row_selected == row" [(ngModel)]="row.Front">
              <option value="">Seleccione...</option>
              <option value="CAR">CAR</option>
              <option value="DSI">DSI</option>
              <option value="OPERACIONES">OPERACIONES</option>
              <option value="PLANTA">PLANTA</option>
              <option value="REGIONAL">REGIONAL</option>
            </select> <small *ngIf="!edit && row_selected == row">{{row.Front}}</small></td>
          <td>
            <select *ngIf="edit && row_selected == row" [(ngModel)]="row.Country">
              <option value="">Seleccione...</option>
              <option value="Argentina">Argentina</option>
              <option value="Chile">Chile</option>
              <option value="Colombia">Colombia</option>
              <option value="Ecuador">Ecuador</option>
              <option value="España">España</option>
              <option value="Venezuela">Venezuela</option>
            </select> <small *ngIf="!edit && row_selected == row">{{row.Country}}</small></td>
          <td><input *ngIf="edit && row_selected == row" [(ngModel)]="row.Contact"/> <small *ngIf="!edit && row_selected == row">{{row.Contact}}</small></td>
          <td>
            <select *ngIf="edit && row_selected == row" [(ngModel)]="row.Area">
              <option value="">Seleccione...</option>
              <option value="AEROPUERTO GYE">AEROPUERTO GYE</option>
              <option value="AEROPUERTO UIO">AEROPUERTO UIO</option>
              <option value="AR">AR</option>
              <option value="AUDITORIA">AUDITORIA</option>
              <option value="BI">BI</option>
              <option value="BODEGA">BODEGA</option>
              <option value="CALIDAD">CALIDAD</option>
              <option value="CAPACITACIÓN INTERNA">CAPACITACIÓN INTERNA</option>
              <option value="CL">CL</option>
              <option value="CO">CO</option>
              <option value="COMPRAS">COMPRAS</option>
              <option value="CONTABILIDAD">CONTABILIDAD</option>
              <option value="CONTABILIDAD Y SAP">CONTABILIDAD Y SAP</option>
              <option value="DSI">DSI</option>
              <option value="ES">ES</option>
              <option value="GESTIÓN">GESTIÓN</option>
              <option value="IT">IT</option>
              <option value="LOGÍSTICA">LOGÍSTICA</option>
              <option value="MANTENIMIENTO">MANTENIMIENTO</option>
              <option value="MERCADEO KFC">MERCADEO KFC</option>
              <option value="MERCADEO OTRAS MARCAS">MERCADEO OTRAS MARCAS</option>
              <option value="NÓMINA">NÓMINA</option>
              <option value="OPERACIONES">OPERACIONES</option>
              <option value="OPERACIONES KFC">OPERACIONES KFC</option>
              <option value="OTROS NEGOCIOS">OTROS NEGOCIOS</option>
              <option value="PLANTAS">PLANTAS</option>
              <option value="PRODUCCIÓN">PRODUCCIÓN</option>
              <option value="PROYECTOS DE CONSTRUCCIÓN">PROYECTOS DE CONSTRUCCIÓN</option>
              <option value="TRANSFORMACIÓN DIGITAL">TRANSFORMACIÓN DIGITAL</option>
              <option value="TESORERÍA">TESORERÍA</option>
              <option value="VE">VE</option>
            </select> <small *ngIf="!edit && row_selected == row">{{row.Area}}</small></td>
          <td>
            <select *ngIf="edit && row_selected == row" [(ngModel)]="row.Approval">
              <option value="">Seleccione...</option>
              <option value="APROBADO">APROBADO</option>
              <option value="IDENTIFICADO">IDENTIFICADO</option>
              <option value="SUSPENDIDO">SUSPENDIDO</option>
            </select> <small *ngIf="!edit && row_selected == row">{{row.Approval}}</small></td>
          <td>
            <select *ngIf="edit && row_selected == row" [(ngModel)]="row.Progress">
              <option value="">Seleccione...</option>
              <option value="Cancelado">Cancelado</option>
              <option value="En curso">En curso</option>
              <option value="Finalizado">Finalizado</option>
              <option value="Identificado">Identificado</option>
              <option value="Iniciado">Iniciado</option>
              <option value="No iniciado">No iniciado</option>
              <option value="Por Levantar">Por Levantar</option>
              <option value="Pruebas">Pruebas</option>
            </select> <small *ngIf="!edit && row_selected == row">{{row.Progress}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="number" [(ngModel)]="row.CustomerPriority"/> <small *ngIf="!edit && row_selected == row">{{row.CustomerPriority}}</small></td>
          <td>
            <select *ngIf="edit && row_selected == row" [(ngModel)]="row.PoPriority">
              <option value="">Seleccione...</option>
              <option value="Q1">Q1</option>
              <option value="Q2">Q2</option>
              <option value="Q3">Q3</option>
              <option value="Q4">Q4</option>
            </select> <small *ngIf="!edit && row_selected == row">{{row.PoPriority}}</small></td>
          <td><input *ngIf="edit && row_selected == row" [(ngModel)]="row.Dependency"/> <small *ngIf="!edit && row_selected == row">{{row.Dependency}}</small></td>
          <td>
            <select *ngIf="edit && row_selected == row" [(ngModel)]="row.Complexity">
              <option value="">Seleccione...</option>
              <option value="BAJA">BAJA</option>
              <option value="MADIA">MADIA</option>
              <option value="ALTA">ALTA</option>
            </select> <small *ngIf="!edit && row_selected == row">{{row.Complexity}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="number" step="0.1" [(ngModel)]="row.CountryFactor"/> <small *ngIf="!edit && row_selected == row">{{row.CountryFactor}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="number" [(ngModel)]="row.Weeks"/> <small *ngIf="!edit && row_selected == row">{{row.Weeks}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="number" [(ngModel)]="row.People"/> <small *ngIf="!edit && row_selected == row">{{row.People}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="number" step="0.1" [(ngModel)]="row.LaborCostPerWeek"/> <small *ngIf="!edit && row_selected == row">{{row.LaborCostPerWeek}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="number" step="0.1" [(ngModel)]="row.OtherCosts"/> <small *ngIf="!edit && row_selected == row">{{row.OtherCosts}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="number" step="0.1" [(ngModel)]="row.Total"/> <small *ngIf="!edit && row_selected == row">{{row.Total}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="number" step="0.1" [(ngModel)]="row.RecurrentCosts"/> <small *ngIf="!edit && row_selected == row">{{row.RecurrentCosts}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="number" step="0.1" [(ngModel)]="row.Roi"/> <small *ngIf="!edit && row_selected == row">{{row.Roi}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="date" [(ngModel)]="row.DevelopmentStart"/> <small *ngIf="!edit && row_selected == row">{{row.DevelopmentStart}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="date" [(ngModel)]="row.DevelopmentEnd"/> <small *ngIf="!edit && row_selected == row">{{row.DevelopmentEnd}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="date" [(ngModel)]="row.PilotStart"/> <small *ngIf="!edit && row_selected == row">{{row.PilotStart}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="date" [(ngModel)]="row.PilotEnd"/> <small *ngIf="!edit && row_selected == row">{{row.PilotEnd}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="date" [(ngModel)]="row.DeploymentStart"/> <small *ngIf="!edit && row_selected == row">{{row.DeploymentStart}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="date" [(ngModel)]="row.DeploymentEnd"/> <small *ngIf="!edit && row_selected == row">{{row.DeploymentEnd}}</small></td>
          <td><input *ngIf="edit && row_selected == row" [(ngModel)]="row.Notes"/> <small *ngIf="!edit && row_selected == row">{{row.Notes}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="number" step="0.1" [(ngModel)]="row.Roi2"/> <small *ngIf="!edit && row_selected == row">{{row.Roi2}}</small></td>
          <td><input *ngIf="edit && row_selected == row" type="number" step="0.1" [(ngModel)]="row.Roi3"/> <small *ngIf="!edit && row_selected == row">{{row.Roi3}}</small></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<ng-template #content_costs let-modal>
  <div class="modal-header">
     <h4 class="modal-title">Costos asociados al item {{row_selected.Id}} del Portafolio</h4>
     <button type="button" class="close" (click)="modal.dismiss('Cross click')">
        <span>&times;</span>
     </button>
  </div>
  <div class="modal-body">
     <app-porfoliocosts></app-porfoliocosts>
  </div>
</ng-template>
